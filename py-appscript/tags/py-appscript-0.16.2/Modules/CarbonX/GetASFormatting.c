/* *	APPLESCRIPT FORMATTING *	GetASFormatting.cp * *	Copyright © 1998-2003 Marco Piovanelli *	All Rights Reserved * *	<marco - piovanelli -at- pobox - com> *	<http://www.merzwaren.com/snippets/> * * *	Modified by HAS, 2005 */static OSStatus ParseStyle ( const STElement * inStyle, AERecord * ioStyleRecord ){	AEKeyword	styleTags [ 7 ] ;	AEDescList	styleList ;	Str255		fontName ;	OSStatus	err ;	styleTags [ 0 ] = kAEBold ;	styleTags [ 1 ] = kAEItalic ;	styleTags [ 2 ] = kAEUnderline ;	styleTags [ 3 ] = kAEOutline ;	styleTags [ 4 ] = kAEShadow ;	styleTags [ 5 ] = kAECondensed ;	styleTags [ 6 ] = kAEExpanded ;	AEInitializeDesc ( & styleList ) ;	//	get font name	if ( ( err = FMGetFontFamilyName ( inStyle -> stFont, fontName ) ) != noErr )	{		goto cleanup ;	}	//	add font name	if ( ( err = AEPutParamPtr ( ioStyleRecord, pFont, typeText, fontName + 1, StrLength ( fontName ) ) ) != noErr )	{		goto cleanup ;	}	//	add point size	if ( ( err = AEPutParamPtr ( ioStyleRecord, pPointSize, typeShortInteger, & inStyle -> stSize, sizeof ( inStyle -> stSize ) ) ) != noErr )	{		goto cleanup ;	}	//	add list of styles	if ( ( err = AECreateList ( 0, 0, false, & styleList ) ) != noErr )	{		goto cleanup ;	}		int styleIndex;	for ( styleIndex = 0 ; styleIndex < 7 ; styleIndex ++ )	{		if ( inStyle -> stFace & ( 1 << styleIndex ) )		{			if ( ( err = AEPutPtr ( & styleList, 0, typeEnumerated,				& styleTags [ styleIndex ], sizeof ( AEKeyword ) ) ) != noErr )			{				goto cleanup ;			}		}	}	if ( ( err = AEPutParamDesc ( ioStyleRecord, pTextStyles, & styleList ) ) != noErr )	{		goto cleanup ;	}	//	add color	if ( ( err = AEPutParamPtr ( ioStyleRecord, pColor, typeRGBColor,		& inStyle -> stColor, sizeof ( inStyle -> stColor ) ) ) != noErr )	{		goto cleanup ;	}	//	clear result code	err = noErr ;cleanup :	AEDisposeDesc ( & styleList ) ;	//	return result code	return err ;}extern pascal OSErr OSA_StyleRecToDesc(STHandle sourceStyles, AEDesc *formatList){	AERecord			styleRecord ;	OSStatus			err ;	AEInitializeDesc ( formatList ) ;	AEInitializeDesc ( & styleRecord ) ;	//	sanity check: make sure the style table is non-null	err = memFullErr ;	if ( sourceStyles == 0 )	{		goto cleanup ;	}	//	sanity check: make sure the style table is big enough to	//	contain all the AppleScript styles	if ( GetHandleSize ( ( Handle ) sourceStyles ) < kASNumberOfSourceStyles * sizeof ( STElement ) )	{		goto cleanup ;	}	//	lock the style table	HLock ( ( Handle ) sourceStyles ) ;	//	create the format list	if ( ( err = AECreateList ( 0, 0, false, formatList ) ) != noErr )	{		goto cleanup ;	}	//	add styles to the list	int styleIndex;	for ( styleIndex = 0 ;		  styleIndex < kASNumberOfSourceStyles ;		  styleIndex ++ )	{		//	create a style record		if ( ( err = AECreateList ( 0, 0, true, & styleRecord ) ) != noErr )		{			goto cleanup ;		}		//	fill it		if ( ( err = ParseStyle ( ( * sourceStyles ) + styleIndex, & styleRecord ) ) != noErr )		{			goto cleanup ;		}		//	add it to the format list		if ( ( err = AEPutDesc ( formatList, 0, & styleRecord ) ) != noErr )		{			goto cleanup ;		}		//	get rid of style record		AEDisposeDesc ( & styleRecord ) ;	}	//	clear result code	err = noErr ;cleanup :	//	forget source styles	if ( sourceStyles != 0 )	{		DisposeHandle ( ( Handle ) sourceStyles ) ;		sourceStyles = 0 ;	}	AEDisposeDesc ( & styleRecord ) ;	//	return result code	return ( OSErr ) err ;}